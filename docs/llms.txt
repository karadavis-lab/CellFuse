# CellFuse

**CellFuse** is an R package for multimodal single-cell and spatial
proteomics integration using supervised contrastive deep learning.
Single-cell and spatial proteomic technologies capture complementary
biological information; however, no single platform measures all
modalities within the same cell. Most existing integration methods
(e.g., Seurat, Harmony) are optimized for transcriptomic data and assume
extensive shared feature overlap, an assumption that often fails for
low-dimensional proteomic modalities.

### Workflow Overview

CellFuse operates in three sequential stages:

1.  **Model Training** – Learn a shared embedding space using labeled
    reference data.
2.  **Cell Type Prediction** – Project query cells into embedding space
    and assign labels via KNN.
3.  **Data Integration** – Perform normalization to harmonize
    modalities.

![](reference/figures/Figure1_v2.png)

This work has been led by [Abhishek
Koladiya](https://github.com/AbhivKoladiya) from [Kara Davis
Lab](https://kldavislab.org/) @Stanford

### Installation

CellFuse relies on Python for deep learning components via the
reticulate interface. Before using the package, please configure a
Python environment with the required dependencies.

We recommend creating a dedicated conda environment:

``` shell
# Create the environment
conda create -n myenv python=3.10 -y

# Activate the environment
conda activate myenv

# Install required Python packages
conda install pytorch pandas scikit-learn matplotlib seaborn
```

After creating the environment, configure it within R:

    # Load and install R dependencies
    required_packages <- c("reticulate", "remotes")

    installed <- required_packages %in% rownames(installed.packages())
    if (any(!installed)) {
      install.packages(required_packages[!installed])
    }

    # Use the conda environment from R
    library(reticulate)

    # Use the conda environment
    use_condaenv("myenv", required = TRUE)

    # Verify Python configuration
    py_config()

    # Install and load CellFuse:
    devtools::install("karadavis-lab/CellFuse")

    library(CellFuse)

## Getting Started

The best way to get started with CellFuse is to explore the package’s
vignettes and articles (available at
<https://karadavis-lab.github.io/CellFuse>).

## Citation

``` bibtex
@article{koladiya2025cellfuse,
  title={CellFuse Enables Multi-modal Integration of Single-cell and Spatial Proteomics Data},
  author={Koladiya, Abhishek and Good, Zinaida and Varra, Sricharan Reddy and Bendall, Sean C and Davis, Kara L},
  journal={bioRxiv},
  year={2025},
  publisher={Cold Spring Harbor Laboratory},
  doi={10.1101/2025.07.23.665976},
  url={https://www.biorxiv.org/content/10.1101/2025.07.23.665976v1}
}
```

# Package index

## All functions

- [`IntegrateData()`](IntegrateData.md) : Integrate query cell types
  with reference cell types
- [`PredictCells()`](PredictCells.md) : Predict query cell types using a
  trained CellFuse model
- [`TrainModel()`](TrainModel.md) : Train CellFuse model using labeled
  reference data
- [`predict_cells_time()`](predict_cells_time.md) : Runtime calculation
  for PredictCells() function

# Articles

### All vignettes

- [CellFuse Workflow: Data Preparation and Model
  Execution](CellFuse_DataPreparation.md):
- [Multi-modal integration of CyTOF and CITE-Seq
  data](Cytof_CITESeq_DataIntegration.md):
