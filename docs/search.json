[{"path":"/articles/CellFuse_DataPreparation.html","id":"project-structure","dir":"Articles","previous_headings":"","what":"Project Structure","title":"CellFuse Workflow: Data Preparation and Model Execution","text":"CellFuse expects standardized directory structure organize reference data, query data, model outputs. recommended project layout : dataset provided CSV file : * Rows correspond individual cells * Columns correspond markers * One column must contain cell type labels (e.g., cluster.orig)","code":"CellFuseProject/ ├── Reference_Data/        ├── Query_Data/  ├── Predicted_Data/        # Output folder for predictions └── Predicted_Data/Saved_model/   # Trained CellFuse model will be saved here"},{"path":"/articles/CellFuse_DataPreparation.html","id":"creating-project-directories","dir":"Articles","previous_headings":"","what":"Creating Project Directories","title":"CellFuse Workflow: Data Preparation and Model Execution","text":"may create required directory structure programmatically:","code":"dir.create(\"Reference_Data\", showWarnings = FALSE) dir.create(\"Query_Data\", showWarnings = FALSE) dir.create(\"Predicted_Data\", showWarnings = FALSE) dir.create(\"Predicted_Data/Saved_model\", showWarnings = FALSE)"},{"path":"/articles/CellFuse_DataPreparation.html","id":"data-preparation","dir":"Articles","previous_headings":"","what":"Data Preparation","title":"CellFuse Workflow: Data Preparation and Model Execution","text":"First split reference data training validation subsets.","code":"library(caret) library(readr)  # Load reference dataset reference_data <- read.csv(\"Reference_Data/CyTOF.csv\")  # Stratified split (preserves class distribution) trainIndex <- createDataPartition(reference_data$cluster.orig,                                   p = 0.7,list = FALSE)  train_data <- reference_data[trainIndex, ] validation_data <- reference_data[-trainIndex, ]  # Save training and validation sets write_csv(train_data, \"Reference_Data/CyTOF_train.csv\") write_csv(validation_data, \"Reference_Data/CyTOF_val.csv\")"},{"path":[]},{"path":"/articles/CellFuse_DataPreparation.html","id":"stage-1-model-training-train-the-cellfuse-model-using-labeled-reference-cell-types-","dir":"Articles","previous_headings":"CellFuse execution:","what":"Stage 1 — Model Training: Train the CellFuse model using labeled reference cell types.","title":"CellFuse Workflow: Data Preparation and Model Execution","text":"","code":"TrainModel(dataset_name = \"CyTOF\",   data_dir = \"path/to/reference_data/\",save_path = \"path/to/save_model/\",     device = \"cpu\",cluster_column = \"cluster.orig\",      lr=as.numeric(0.0009), margin=as.numeric(0.8), bs=as.integer(256), epoch=as.integer(50),     k=as.integer(5), min_delta=as.numeric(0.01), patience=as.integer(5), val_step=as.integer(5),     output_dim=as.integer(8), dropout_prob=as.numeric(0.7),     activation_function='leaky_relu',alpha=as.numeric(0.01))"},{"path":"/articles/CellFuse_DataPreparation.html","id":"stage-2-cell-type-prediction-use-trained-cellfuse-model-to-predict-query-cell-types","dir":"Articles","previous_headings":"CellFuse execution:","what":"Stage 2 (Cell type Prediction): Use trained CellFuse model to predict Query cell types","title":"CellFuse Workflow: Data Preparation and Model Execution","text":"","code":"PredictCells(dataset_name = \"CyTOF\",data_dir = \"path/to/reference_data/\",   test_data_dir = \"path/to/query_data/\",   test_data = \"CITEseq\",model_dir = \"path/to/save_model/Saved_model\",   model_date=\"YYYY-MM-DD\",device=\"cpu\",cluster_column='cluster.orig',   lr=as.numeric(0.001),margin=0.5,bs=as.integer(256), epoch=as.integer(50),   knn_k=as.integer(5),output_dim=as.integer(8),   dropout_prob=as.numeric(0.5),activation_function='leaky_relu')"},{"path":"/articles/CellFuse_DataPreparation.html","id":"stage-3-data-integration-integrate-query-cell-types-with-reference-cell-types","dir":"Articles","previous_headings":"CellFuse execution:","what":"Stage 3 (Data Integration): Integrate query cell types with reference cell types","title":"CellFuse Workflow: Data Preparation and Model Execution","text":"","code":"corrected_data <- IntegrateData(   ref_path=\"Reference_Data/CyTOF_train.csv\",query_path=\"Query_Data/CITEseq_test.csv\",   Celltype_col=\"cluster.orig\")"},{"path":"/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Abhishek Koladiya. Author, maintainer.","code":""},{"path":"/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Koladiya et al. (2025). CellFuse Enables Multi-modal Integration Single-cell Spatial Proteomics Data. bioRxiv. doi:10.1101/2025.07.23.665976","code":"@Article{,   title = {CellFuse Enables Multi-modal Integration of Single-cell and Spatial Proteomics Data},   author = {Abhishek Koladiya and Zinaida Good and Sricharan Reddy Varra and Sean C Bendall and Kara L Davis},   journal = {bioRxiv},   year = {2025},   doi = {10.1101/2025.07.23.665976},   url = {https://www.biorxiv.org/content/10.1101/2025.07.23.665976v1}, }"},{"path":"/index.html","id":"cellfuse","dir":"","previous_headings":"","what":"CellFuse: Multi-modal integration of single-cell and spatial proteomics data","title":"CellFuse: Multi-modal integration of single-cell and spatial proteomics data","text":"CellFuse R package multimodal single-cell spatial proteomics integration using supervised contrastive deep learning. Single-cell spatial proteomic technologies capture complementary biological information; however, single platform measures modalities within cell. existing integration methods (e.g., Seurat, Harmony) optimized transcriptomic data assume extensive shared feature overlap, assumption often fails low-dimensional proteomic modalities.","code":""},{"path":"/index.html","id":"workflow-overview","dir":"","previous_headings":"","what":"Workflow Overview","title":"CellFuse: Multi-modal integration of single-cell and spatial proteomics data","text":"CellFuse operates three sequential stages: Model Training – Learn shared embedding space using labeled reference data. Cell Type Prediction – Project query cells embedding space assign labels via KNN. Data Integration – Perform normalization harmonize modalities.  work led Abhishek Koladiya Kara Davis Lab @Stanford","code":""},{"path":"/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"CellFuse: Multi-modal integration of single-cell and spatial proteomics data","text":"CellFuse relies Python deep learning components via reticulate interface. using package, please configure Python environment required dependencies. recommend creating dedicated conda environment: creating environment, configure within R:","code":"# Create the environment conda create -n myenv python=3.10 -y  # Activate the environment conda activate myenv  # Install required Python packages conda install pytorch pandas scikit-learn matplotlib seaborn # Load and install R dependencies required_packages <- c(\"reticulate\", \"remotes\")  installed <- required_packages %in% rownames(installed.packages()) if (any(!installed)) {   install.packages(required_packages[!installed]) }  # Use the conda environment from R library(reticulate)  # Use the conda environment use_condaenv(\"myenv\", required = TRUE)  # Verify Python configuration py_config()  # Install and load CellFuse: devtools::install(\"karadavis-lab/CellFuse\")  library(CellFuse)"},{"path":"/index.html","id":"getting-started","dir":"","previous_headings":"","what":"Getting Started","title":"CellFuse: Multi-modal integration of single-cell and spatial proteomics data","text":"best way get started CellFuse explore package’s vignettes articles (available https://karadavis-lab.github.io/CellFuse).","code":""},{"path":"/index.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"CellFuse: Multi-modal integration of single-cell and spatial proteomics data","text":"","code":"@article{koladiya2025cellfuse,   title={CellFuse Enables Multi-modal Integration of Single-cell and Spatial Proteomics Data},   author={Koladiya, Abhishek and Good, Zinaida and Varra, Sricharan Reddy and Bendall, Sean C and Davis, Kara L},   journal={bioRxiv},   year={2025},   publisher={Cold Spring Harbor Laboratory},   doi={10.1101/2025.07.23.665976},   url={https://www.biorxiv.org/content/10.1101/2025.07.23.665976v1} }"},{"path":"/reference/IntegrateData.html","id":null,"dir":"Reference","previous_headings":"","what":"Integrate query cell types with reference cell types — IntegrateData","title":"Integrate query cell types with reference cell types — IntegrateData","text":"function normalizes query data reference data using PCA-space quantile normalization, performed separately cell type.","code":""},{"path":"/reference/IntegrateData.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Integrate query cell types with reference cell types — IntegrateData","text":"","code":"IntegrateData(ref_path, query_path, Celltype_col)"},{"path":"/reference/IntegrateData.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Integrate query cell types with reference cell types — IntegrateData","text":"ref_path Path reference CSV file. query_path Path predicted query CSV file. Celltype_col Character. Column containing cell-type labels.","code":""},{"path":"/reference/IntegrateData.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Integrate query cell types with reference cell types — IntegrateData","text":"data.frame containing normalized query marker values.","code":""},{"path":"/reference/IntegrateData.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Integrate query cell types with reference cell types — IntegrateData","text":"Normalization performed separately per cell type. numeric marker columns processed.","code":""},{"path":"/reference/IntegrateData.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Integrate query cell types with reference cell types — IntegrateData","text":"","code":"if (FALSE) { # \\dontrun{ corrected <- IntegrateData(   ref_path = \"Reference_Data/CyTOF_train.csv\",   query_path = \"Query_Data/CITEseq_test.csv\",   Celltype_col = \"cluster.orig\" ) } # }"},{"path":"/reference/NormalizeData.html","id":null,"dir":"Reference","previous_headings":"","what":"PCA-space Normalization — NormalizeData","title":"PCA-space Normalization — NormalizeData","text":"PCA-space Normalization","code":""},{"path":"/reference/NormalizeData.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"PCA-space Normalization — NormalizeData","text":"","code":"NormalizeData(ct1_rep1_i_sig, file_ref_sig)"},{"path":"/reference/NormalizeData.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"PCA-space Normalization — NormalizeData","text":"ct1_rep1_i_sig Target matrix file_ref_sig Reference matrix","code":""},{"path":"/reference/NormalizeData.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"PCA-space Normalization — NormalizeData","text":"normalized matrix original (reference) space","code":""},{"path":"/reference/Normalize_function.html","id":null,"dir":"Reference","previous_headings":"","what":"Normalization function — Normalize_function","title":"Normalization function — Normalize_function","text":"Normalization function","code":""},{"path":"/reference/Normalize_function.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Normalization function — Normalize_function","text":"","code":"Normalize_function(target, reference)"},{"path":"/reference/Normalize_function.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Normalization function — Normalize_function","text":"target Matrix normalize reference Reference matrix","code":""},{"path":"/reference/Normalize_function.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Normalization function — Normalize_function","text":"normalized matrix","code":""},{"path":"/reference/PredictCells.html","id":null,"dir":"Reference","previous_headings":"","what":"Predict query cell types using a trained CellFuse model — PredictCells","title":"Predict query cell types using a trained CellFuse model — PredictCells","text":"Projects query cells previously learned embedding space assigns predicted cell type labels using K-nearest neighbors.","code":""},{"path":"/reference/PredictCells.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Predict query cell types using a trained CellFuse model — PredictCells","text":"","code":"PredictCells(   dataset_name,   data_dir,   test_data_dir,   test_data,   model_dir,   model_date,   device,   cluster_column,   lr,   margin,   bs,   epoch,   knn_k,   output_dim,   dropout_prob,   activation_function )"},{"path":"/reference/PredictCells.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Predict query cell types using a trained CellFuse model — PredictCells","text":"dataset_name Character. Name training dataset. data_dir Character. Path reference data directory. test_data_dir Character. Path query dataset directory. test_data Character. Name query dataset. model_dir Character. Path saved model directory. model_date Character. Timestamp identifying trained model. YYYY-MM-DD device Character. \"cpu\" \"cuda\". cluster_column Character. Column containing cluster labels. lr Numeric. Learning rate. margin Numeric. Margin contrastive loss. bs Integer. Batch size. epoch Integer. Number epochs. knn_k Integer. Number neighbors KNN classification. output_dim Integer. Embedding dimension. dropout_prob Numeric. Dropout probability. activation_function Character. Activation function.","code":""},{"path":"/reference/PredictCells.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Predict query cell types using a trained CellFuse model — PredictCells","text":"Invisibly returns NULL. Prediction results written disk.","code":""},{"path":"/reference/PredictCells.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Predict query cell types using a trained CellFuse model — PredictCells","text":"function loads trained CellFuse model applies query dataset query dataset must: Contain markers used training rows corresponding individual cells Predicted labels embeddings saved output directory.","code":""},{"path":[]},{"path":"/reference/PredictCells.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Predict query cell types using a trained CellFuse model — PredictCells","text":"","code":"if (FALSE) { # \\dontrun{ PredictCells(   dataset_name = \"CyTOF\",   data_dir = \"Reference_Data/\",   test_data_dir = \"Query_Data/\",   model_dir = \"Predicted_Data/Saved_model\" ) } # }"},{"path":"/reference/TrainModel.html","id":null,"dir":"Reference","previous_headings":"","what":"Train CellFuse model using labeled reference data — TrainModel","title":"Train CellFuse model using labeled reference data — TrainModel","text":"#' @description Trains supervised contrastive learning model labeled reference proteomics dataset learn shared embedding space downstream cross-modality cell type prediction.","code":""},{"path":"/reference/TrainModel.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Train CellFuse model using labeled reference data — TrainModel","text":"","code":"TrainModel(   dataset_name,   data_dir,   save_path,   device,   cluster_column,   lr,   margin,   bs,   epoch,   k,   min_delta,   patience,   val_step,   output_dim,   dropout_prob,   activation_function,   alpha )"},{"path":"/reference/TrainModel.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Train CellFuse model using labeled reference data — TrainModel","text":"dataset_name Name dataset (e.g., \"Levine32\") data_dir Path reference dataset directory save_path Path directory model outputs saved device Device use (\"cpu\" \"cuda\") cluster_column Column name cluster labels metadata lr Learning rate margin Margin contrastive loss bs Batch size epoch Number training epochs k K KNN classifier min_delta Minimum improvement early stopping patience Number validation steps improvement stopping val_step Number steps validation checks output_dim Dimension embedding space dropout_prob Dropout probability activation_function Activation function (e.g., 'relu', 'leaky_relu') alpha Weight auxiliary loss regularization term","code":""},{"path":"/reference/TrainModel.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Train CellFuse model using labeled reference data — TrainModel","text":"Invisibly returns NULL. function writes following outputs save_path: Trained CellFuse model weights (saved Saved_model/) Training validation performance metrics PNG file containing training curves (loss accuracy vs epoch) Optional intermediate artifacts required downstream prediction","code":""},{"path":"/reference/TrainModel.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Train CellFuse model using labeled reference data — TrainModel","text":"function uses Python backend (via reticulate) implement supervised contrastive learning. reference dataset must contain: Rows corresponding individual cells Columns corresponding protein markers column containing cell type labels (specified cluster_column) trained model, embeddings, performance metrics saved save_path, including timestamped folder Saved_model/. Model performance visualized training validation loss accuracy across epochs saved automatically specified output directory. Early stopping applied based validation loss.","code":""},{"path":"/reference/TrainModel.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Train CellFuse model using labeled reference data — TrainModel","text":"","code":"if (FALSE) { # \\dontrun{ TrainModel(   dataset_name = \"CyTOF\",   data_dir = \"Reference_Data/\",   save_path = \"Predicted_Data/\",   device = \"cpu\",   cluster_column = \"cluster.orig\" ) } # }"},{"path":"/reference/predict_cells_time.html","id":null,"dir":"Reference","previous_headings":"","what":"Runtime calculation for PredictCells() function — predict_cells_time","title":"Runtime calculation for PredictCells() function — predict_cells_time","text":"Evaluates computational runtime CellFuse query prediction step.","code":""},{"path":"/reference/predict_cells_time.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Runtime calculation for PredictCells() function — predict_cells_time","text":"","code":"predict_cells_time(   dataset_name,   data_dir,   test_data_dir,   test_data,   model_dir,   model_date,   device,   cluster_column,   lr,   margin,   bs,   epoch,   knn_k,   output_dim,   dropout_prob,   activation_function )"},{"path":"/reference/predict_cells_time.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Runtime calculation for PredictCells() function — predict_cells_time","text":"dataset_name Name training dataset data_dir Path reference data directory test_data_dir Path query/test data directory test_data Name test dataset model_dir Path saved model directory model_date Date model created (helps CellFuse load correct model) device 'cpu' 'cuda' cluster_column Column name containing cluster labels lr Learning rate margin Margin value contrastive loss bs Batch size epoch Number epochs knn_k K KNN classifier output_dim Size embedding output dropout_prob Dropout probability activation_function Activation function name","code":""},{"path":"/reference/predict_cells_time.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Runtime calculation for PredictCells() function — predict_cells_time","text":"Numeric value indicating runtime (seconds).","code":""},{"path":"/reference/predict_cells_time.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Runtime calculation for PredictCells() function — predict_cells_time","text":"Useful benchmarking CPU/GPU performance scalability analysis.","code":""}]
